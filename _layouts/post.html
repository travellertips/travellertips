<!doctype html>

<html lang="{{ page.lang | default: site.lang | default: "en" }}">

{% include head.html %}

<body>
   
    {% include header-inner.html %}

    <main class="main-content post" aria-label="Content" role="main">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

            <header class="post-header clearfix">
                <h1 class="post-title{% if page.capsule != null %} capsule-title{% endif %}" itemprop="name headline">
                    {% if page.capsule == 'new' %}
                        <span class="capsule"></span>
                    {% endif %}
                    {% if page.capsule == 'found' %}
                        <span class="capsule-found"></span>
                    {% endif %}
                    
                    {{ page.title | escape }}
                </h1>
                <div class="post-subheader-left">
                    <div class="post-meta">
                        <p class="post-author">
                            by <a class="navlink" href="{{ page.authorlink }}">{{ page.author }}</a>
                        </p>
                        <time datetime="{{ page.date | date_to_long_string }}" itemprop="datePublished">
                            {{ page.date | date_to_long_string }}
                        </time>  
                    </div>                     
                </div>
                <div class="post-subheader-right">
                    {% if page.pdfguide!=null %}
                        {% include download-button.html guide=page.pdfguide %} 
                    {% endif %}                 
                </div>                              
            </header>

            <div class="post-content" itemprop="articleBody">
                {{ content }}
            </div>
            
            <hr>
            
            <div class="related-posts">
                <h2>You may also like</h2> 
                
                <div class="related-posts-container">
                
                {% assign maxRelated = 3 %}
                {% assign minCommonTags =  1 %}
                {% assign maxRelatedCounter = 0 %}

                {% for post in site.posts %}

                    {% assign sameTagCount = 0 %}
                    {% assign commonTags = '' %}
                    
                    {% for tag in post.tags %}
                      {% if post.url != page.url %}
                        {% if page.tags contains tag %}
                          {% assign sameTagCount = sameTagCount | plus: 1 %}
                          {% capture tagmarkup %} <span class="label label-default">{{ tag }}</span> {% endcapture %}
                          {% assign commonTags = commonTags | append: tagmarkup %}
                        {% endif %}
                      {% endif %}
                    {% endfor %}

                    {% if sameTagCount >= minCommonTags %}
                        <div>
                            <h3><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></h3>
                            {% if post.thumbnail %}
                                <a href="{{ site.baseurl }}{{ post.url }}">{% asset {{post.thumbsmall}} alt="{{post.title}}" %}</a>
                            {% endif %}
                        </div>
                        {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
                        {% if maxRelatedCounter >= maxRelated %}
                            {% break %}
                        {% endif %}
                    {% endif %}

                {% endfor %}
                
                </div>

            </div>

        </article>
        
        <hr>
        
        {% if page.comments %}
            {% include disqus_comments.html %}
        {% endif %}
    </main>
    
    <hr>
    
    {% include footer.html %}

    {% include javascripts.html %}
    
</body>
</html>

   
